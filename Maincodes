package org.example.util;

import org.example.model.ExportData;
import org.example.model.MergedEntity;
import org.example.repository.ExportDataRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import java.util.List;

@Component
public class CsvExportUtil {

    @Autowired
    private ExportDataRepository exportDataRepository;

    public void saveToDatabase(List<MergedEntity> mergedEntities) {
        System.out.println(">>> Saving to DB...");
        for (MergedEntity entity : mergedEntities) {
            ExportData data = new ExportData();
            data.setCrsCode(entity.getIdentifiers().getCrsCode());
            data.setRegAddress(entity.getRegistrationAddress() != null ? entity.getRegistrationAddress().getFullAddress() : null);
            data.setRegCountry(entity.getRegistrationAddress() != null ? entity.getRegistrationAddress().getCountry() : null);
            data.setSiteBnpp(entity.getKycSites().isEmpty() ? null : entity.getKycSites().get(0).getSiteEntity());
            data.setSiteCountry(entity.getKycSites().isEmpty() ? null : entity.getKycSites().get(0).getSiteCountry());
            data.setSiteStatus(entity.getKycSites().isEmpty() ? null : entity.getKycSites().get(0).getSiteStatus());
            data.setKycSegment(entity.getKycSegments().isEmpty() ? null : entity.getKycSegments().get(0).getKycSegment());
            data.setRic(entity.getRadixData().isEmpty() ? null : entity.getRadixData().get(0).getRic());

            exportDataRepository.save(data);
        }
        System.out.println(">>> Data saved to H2.");
    }
}
