@Service
public class ApiService {

    @Autowired
    private RestTemplate restTemplate;

    public List<Map<String, Object>> getAllMergedData() {
        String usersUrl = "http://api1.com/users";

        List<Map<String, Object>> userList = restTemplate.getForObject(usersUrl, List.class);
        List<Map<String, Object>> mergedList = new ArrayList<>();

        if (userList == null) return mergedList;

        for (Map<String, Object> userData : userList) {
            Object idObj = userData.get("id");
            if (idObj == null) continue;

            Long userId = ((Number) idObj).longValue();
            String addressUrl = "http://api2.com/addresses/" + userId;

            Map<String, Object> addressData = restTemplate.getForObject(addressUrl, Map.class);

            Map<String, Object> merged = new HashMap<>();
            merged.putAll(userData);        // dynamic fields from user
            if (addressData != null) {
                merged.putAll(addressData); // dynamic fields from address
            }

            mergedList.add(merged);
        }

        return mergedList;
    }
}
